<!DOCTYPE html>
<!-- saved from url=(0087)https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html -->
<html lang="zh-hans"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style class="vjs-styles-defaults">
      .video-js {
        width: 300px;
        height: 150px;
      }

      .vjs-fluid {
        padding-top: 56.25%
      }
    </style>
        
        
        <title>kubelet 创建 pod 的流程 · 田飞雨</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="gosoon">
        
        
    
    
    <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/style.css">

    
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/search.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/prism-base16-ateliersulphurpool.light.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/ace.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin(1).css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/katex.min.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/splitter.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/mermaid.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/footer.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/sectionx.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/video-js.min.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin(2).css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin(3).css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/style(1).css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin(4).css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/website.css">
                
            
                
                <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/test.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/website(1).css">
        
    
        
    
        
    
        
    
        
    
        
    


    

        
    
    
    
    
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://blog.tianfeiyu.com/source-code-reading-notes/gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="https://blog.tianfeiyu.com/source-code-reading-notes/gitbook/images/favicon.ico" type="image/x-icon">

    
    
    
    
    
    

    
    <link rel="stylesheet" href="./kubelet 创建 pod 的流程 · 田飞雨_files/c3.min.css">
    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/hm.js.下载"></script><script src="./kubelet 创建 pod 的流程 · 田飞雨_files/d3.min.js.下载"></script>
    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/c3.min.js.下载"></script>
    

    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/d3.min.js(1).下载"></script>
    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/function-plot.js.下载"></script>    

    
        <link rel="shortcut icon" href="https://blog.tianfeiyu.com/source-code-reading-notes/favicon.ico" type="image/x-icon">
    
    
        <link rel="bookmark" href="https://blog.tianfeiyu.com/source-code-reading-notes/favicon.ico" type="image/x-icon">
    
    
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"gosoon/source-code-reading-notes","types":["star"],"size":"large"};
    </script>

    <style id="ace_editor.css">.ace_editor {position: relative;overflow: hidden;font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;direction: ltr;}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;min-width: 100%;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: '';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;text-indent: -1em;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: inherit;color: inherit;z-index: 1000;opacity: 1;text-indent: 0;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;}.ace_text-layer {font: inherit !important;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {-webkit-transition: opacity 0.18s;transition: opacity 0.18s;}.ace_editor.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.ace_line .ace_fold {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {-webkit-transition: opacity 0.4s ease 0.05s;transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {-webkit-transition: opacity 0.05s ease 0.05s;transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}
/*# sourceURL=ace/css/ace_editor.css */</style><style id="ace-tm">.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}
/*# sourceURL=ace/css/ace-tm */</style><style>    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }</style><link rel="prev" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_init.html"><link rel="next" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/node_status.html"></head>
    <body>
        
<div class="book without-animation with-summary font-size-2 font-family-1">
    <div class="book-summary" style="width: 466px; left: 0px; position: absolute;">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://blog.tianfeiyu.com/" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter expanded" data-level="1.1" data-path="../">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter expanded" data-level="1.2" data-path="./">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/">
            
                    
                        <b>1.2.</b>
                    
                    kubernetes
            
                <i class="exc-trigger fa"></i></a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="kube_apiserver.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_apiserver.html">
            
                    
                        <b>1.2.1.</b>
                    
                    kube-apiserver 的设计与实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="apiserver_bootstrap_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/apiserver_bootstrap_controller.html">
            
                    
                        <b>1.2.2.</b>
                    
                    kube-apiserver 中 apiserver service 的实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="nodelifecycle_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/nodelifecycle_controller.html">
            
                    
                        <b>1.2.3.</b>
                    
                    node controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="job_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/job_controller.html">
            
                    
                        <b>1.2.4.</b>
                    
                    job controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="garbagecollector_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/garbagecollector_controller.html">
            
                    
                        <b>1.2.5.</b>
                    
                    garbage collector controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="daemonset_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/daemonset_controller.html">
            
                    
                        <b>1.2.6.</b>
                    
                    daemonset controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="statefulset_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/statefulset_controller.html">
            
                    
                        <b>1.2.7.</b>
                    
                    statefulset controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="deployment_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/deployment_controller.html">
            
                    
                        <b>1.2.8.</b>
                    
                    deployment controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="replicaset_controller.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/replicaset_controller.html">
            
                    
                        <b>1.2.9.</b>
                    
                    replicaset controller 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="kube_scheduler_process.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_scheduler_process.html">
            
                    
                        <b>1.2.10.</b>
                    
                    kube-scheduler 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="kube_scheduler_algorithm.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_scheduler_algorithm.html">
            
                    
                        <b>1.2.11.</b>
                    
                    kube-scheduler predicates 与 priorities 调度算法源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="kube_scheduler_preempt.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_scheduler_preempt.html">
            
                    
                        <b>1.2.12.</b>
                    
                    kube-scheduler 优先级与抢占机制源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="k8s_service_theory.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/k8s_service_theory.html">
            
                    
                        <b>1.2.13.</b>
                    
                    kubernetes service 原理解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="kube_proxy_process.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_proxy_process.html">
            
                    
                        <b>1.2.14.</b>
                    
                    kube-proxy 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="kube_proxy_iptables.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_proxy_iptables.html">
            
                    
                        <b>1.2.15.</b>
                    
                    kube-proxy iptables 模式源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.16" data-path="kube_proxy_ipvs.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kube_proxy_ipvs.html">
            
                    
                        <b>1.2.16.</b>
                    
                    kube-proxy ipvs 模式源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter expanded" data-level="1.2.17" data-path="kubelet-modules.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet-modules.html">
            
                    
                        <b>1.2.17.</b>
                    
                    kubelet 架构浅析
            
                </a>
            

            
        </li>
    
        <li class="chapter expanded" data-level="1.2.18" data-path="kubelet_init.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_init.html">
            
                    
                        <b>1.2.18.</b>
                    
                    kubelet 启动流程分析
            
                </a>
            

            
        </li>
    
        <li class="chapter active expanded" data-level="1.2.19" data-path="kubelet_create_pod.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html">
            
                    
                        <b>1.2.19.</b>
                    
                    kubelet 创建 pod 的流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.20" data-path="node_status.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/node_status.html">
            
                    
                        <b>1.2.20.</b>
                    
                    kubelet 状态上报的方式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.21" data-path="k8s_events.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/k8s_events.html">
            
                    
                        <b>1.2.21.</b>
                    
                    kubelet 中事件处理机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.22" data-path="kubelet_status_manager.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_status_manager.html">
            
                    
                        <b>1.2.22.</b>
                    
                    kubelet statusManager 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.23" data-path="kubelet_qos.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_qos.html">
            
                    
                        <b>1.2.23.</b>
                    
                    kubernetes 中 Qos 的设计与实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.24" data-path="kubelet_garbage_collect.html">
            
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_garbage_collect.html">
            
                    
                        <b>1.2.24.</b>
                    
                    kubelet 中垃圾回收机制的设计与实现
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com/" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    <div class="divider-content-summary"><div class="divider-content-summary__icon"><i class="fa fa-ellipsis-v"></i></div></div></div>

    <div class="book-body" style="left: 466px; position: absolute;">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <a class="btn pull-left js-toolbar-action" aria-label="" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-align-justify"></i></a><a class="btn pull-right js-toolbar-action" aria-label="GitHub" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-github"></i></a><a class="btn pull-left js-toolbar-action" aria-label="" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-edit"></i> Edit This Page</a><div class="dropdown pull-right js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Share" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-share-alt"></i></a><div class="dropdown-menu dropdown-left"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-10 ">Facebook</button><button class="button size-10 ">Google+</button><button class="button size-10 ">Twitter</button><button class="button size-10 ">新浪微博</button><button class="button size-10 ">instapaper</button><button class="button size-10 ">Linkedin</button><button class="button size-10 ">Pocket</button><button class="button size-10 ">StumbleUpon</button><button class="button size-10 ">QQ</button><button class="button size-10 ">QQ空间</button></div></div></div><a class="btn pull-right js-toolbar-action" aria-label="" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-google-plus"></i></a><a class="btn pull-right js-toolbar-action" aria-label="" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-linkedin"></i></a><a class="btn pull-right js-toolbar-action" aria-label="" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-weibo"></i></a><div class="dropdown pull-left font-settings js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Font Settings" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#"><i class="fa fa-font"></i></a><div class="dropdown-menu dropdown-right"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-2 font-reduce">A</button><button class="button size-2 font-enlarge">A</button></div><div class="buttons"><button class="button size-2 ">Serif</button><button class="button size-2 ">Sans</button></div><div class="buttons"><button class="button size-3 ">White</button><button class="button size-3 ">Sepia</button><button class="button size-3 ">Night</button></div></div></div><a class="btn pull-right hidden-mobile" aria-label="github">
        <iframe style="display:inline-block;vertical-align:middle;" src="./kubelet 创建 pod 的流程 · 田飞雨_files/github-btn.html" frameborder="0" scrolling="0" width="150px" height="30px"></iframe>
        </a><h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="https://blog.tianfeiyu.com/source-code-reading-notes/">kubelet 创建 pod 的流程</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <ul>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#kubelet-%E5%88%9B%E5%BB%BA-pod-%E7%9A%84%E6%B5%81%E7%A8%8B">kubelet 创建 pod 的流程</a><ul>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#1kubelet-%E7%9A%84%E6%8E%A7%E5%88%B6%E5%BE%AA%E7%8E%AFsyncloop">1、kubelet 的控制循环（syncLoop）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#2%E7%9B%91%E5%90%AC-pod-%E5%8F%98%E5%8C%96syncloopiteration">2、监听 pod 变化（syncLoopIteration）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#3%E5%A4%84%E7%90%86%E6%96%B0%E5%A2%9E-podhandlepodaddtions">3、处理新增 pod（HandlePodAddtions）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#4%E4%B8%8B%E5%8F%91%E4%BB%BB%E5%8A%A1dispatchwork">4、下发任务（dispatchWork）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#5%E6%9B%B4%E6%96%B0%E4%BA%8B%E4%BB%B6%E7%9A%84-channelupdatepod">5、更新事件的 channel（UpdatePod）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#6%E8%B0%83%E7%94%A8-syncpodfn-%E6%96%B9%E6%B3%95%E5%90%8C%E6%AD%A5-podmanagepodloop">6、调用 syncPodFn 方法同步 pod（managePodLoop）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#7%E5%AE%8C%E6%88%90%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9Csyncpod">7、完成创建容器前的准备工作（SyncPod）</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#8%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8">8、创建容器</a></li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#9%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8">9、启动容器</a></li>
</ul>
</li>
<li><a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<p>上篇文章介绍了 <a href="http://blog.tianfeiyu.com/2018/12/23/kubelet_init/" target="_blank">kubelet 的启动流程</a>，本篇文章主要介绍 kubelet 创建 pod 的流程。</p>
<blockquote>
<p>kubernetes 版本： v1.12 </p>
</blockquote>
<p><img src="./kubelet 创建 pod 的流程 · 田飞雨_files/kubelet-1.png" alt="kubelet 工作原理"></p>
<p>kubelet 的工作核心就是在围绕着不同的生产者生产出来的不同的有关 pod 的消息来调用相应的消费者（不同的子模块）完成不同的行为(创建和删除 pod 等)，即图中的控制循环（SyncLoop），通过不同的事件驱动这个控制循环运行。</p>
<p>本文仅分析新建 pod 的流程，当一个 pod 完成调度，与一个 node 绑定起来之后，这个 pod 就会触发 kubelet 在循环控制里注册的 handler，上图中的 HandlePods 部分。此时，通过检查 pod 在 kubelet 内存中的状态，kubelet 就能判断出这是一个新调度过来的 pod，从而触发 Handler 里的 ADD 事件对应的逻辑处理。然后 kubelet 会为这个 pod 生成对应的 podStatus，接着检查 pod 所声明的 volume 是不是准备好了，然后调用下层的容器运行时。如果是 update 事件的话，kubelet 就会根据 pod 对象具体的变更情况，调用下层的容器运行时进行容器的重建。</p>
<h2 id="kubelet-创建-pod-的流程"><a name="kubelet-创建-pod-的流程" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#kubelet-%E5%88%9B%E5%BB%BA-pod-%E7%9A%84%E6%B5%81%E7%A8%8B"><i class="fa fa-link" aria-hidden="true"></i></a>kubelet 创建 pod 的流程</h2>
<p><img src="./kubelet 创建 pod 的流程 · 田飞雨_files/kubelet-2.png" alt="kubelet 创建 pod 的流程"></p>
<h3 id="1、kubelet-的控制循环（syncloop）"><a name="1、kubelet-的控制循环（syncloop）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#1%E3%80%81kubelet-%E7%9A%84%E6%8E%A7%E5%88%B6%E5%BE%AA%E7%8E%AF%EF%BC%88syncloop%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>1、kubelet 的控制循环（syncLoop）</h3>
<p>syncLoop 中首先定义了一个 syncTicker 和 housekeepingTicker，即使没有需要更新的 pod 配置，kubelet 也会定时去做同步和清理 pod 的工作。然后在 for 循环中一直调用 syncLoopIteration，如果在每次循环过程中出现比较严重的错误，kubelet 会记录到 runtimeState 中，遇到错误就等待 5 秒中继续循环。</p>
<pre class="language-"><code>func (kl *Kubelet) syncLoop(updates &lt;-chan kubetypes.PodUpdate, handler SyncHandler) {
    glog.Info("Starting kubelet main sync loop.")

    // syncTicker 每秒检测一次是否有需要同步的 pod workers
    syncTicker := time.NewTicker(time.Second)
    defer syncTicker.Stop()
    // 每两秒检测一次是否有需要清理的 pod
    housekeepingTicker := time.NewTicker(housekeepingPeriod)
    defer housekeepingTicker.Stop()
    // pod 的生命周期变化
    plegCh := kl.pleg.Watch()
    const (
        base   = 100 * time.Millisecond
        max    = 5 * time.Second
        factor = 2
    )
    duration := base
    for {
        if rs := kl.runtimeState.runtimeErrors(); len(rs) != 0 {
            time.Sleep(duration)
            duration = time.Duration(math.Min(float64(max), factor*float64(duration)))
            continue
        }
        ...

        kl.syncLoopMonitor.Store(kl.clock.Now())
        // 第二个参数为 SyncHandler 类型，SyncHandler 是一个 interface，
        // 在该文件开头处定义
        if !kl.syncLoopIteration(updates, handler, syncTicker.C, housekeepingTicker.C, plegCh) {
            break
        }
        kl.syncLoopMonitor.Store(kl.clock.Now())
    }
}
</code></pre><h3 id="2、监听-pod-变化（syncloopiteration）"><a name="2、监听-pod-变化（syncloopiteration）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#2%E3%80%81%E7%9B%91%E5%90%AC-pod-%E5%8F%98%E5%8C%96%EF%BC%88syncloopiteration%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>2、监听 pod 变化（syncLoopIteration）</h3>
<p>syncLoopIteration 这个方法就会对多个管道进行遍历，发现任何一个管道有消息就交给 handler 去处理。它会从以下管道中获取消息：</p>
<ul>
<li>configCh：该信息源由 kubeDeps 对象中的 PodConfig 子模块提供，该模块将同时 watch 3 个不同来源的 pod 信息的变化（file，http，apiserver），一旦某个来源的 pod 信息发生了更新（创建/更新/删除），这个 channel 中就会出现被更新的 pod 信息和更新的具体操作。</li>
<li>syncCh：定时器管道，每隔一秒去同步最新保存的 pod 状态</li>
<li>houseKeepingCh：housekeeping 事件的管道，做 pod 清理工作</li>
<li>plegCh：该信息源由 kubelet 对象中的 pleg 子模块提供，该模块主要用于周期性地向 container runtime 查询当前所有容器的状态，如果状态发生变化，则这个 channel 产生事件。</li>
<li>livenessManager.Updates()：健康检查发现某个 pod 不可用，kubelet 将根据 Pod 的restartPolicy 自动执行正确的操作</li>
</ul>
<pre class="language-"><code>func (kl *Kubelet) syncLoopIteration(configCh &lt;-chan kubetypes.PodUpdate, handler SyncHandler,
    syncCh &lt;-chan time.Time, housekeepingCh &lt;-chan time.Time, plegCh &lt;-chan *pleg.PodLifecycleEvent) bool {
    select {
    case u, open := &lt;-configCh:
        if !open {
            glog.Errorf("Update channel is closed. Exiting the sync loop.")
            return false
        }

        switch u.Op {
        case kubetypes.ADD:
            ...
        case kubetypes.UPDATE:
            ...
        case kubetypes.REMOVE:
            ...
        case kubetypes.RECONCILE:
            ...
        case kubetypes.DELETE:
            ...
        case kubetypes.RESTORE:
            ...
        case kubetypes.SET:
            ...
        }
        ...
    case e := &lt;-plegCh:
        ...
    case &lt;-syncCh:
        ...
    case update := &lt;-kl.livenessManager.Updates():
        ...
    case &lt;-housekeepingCh:
        ...
    }
    return true
}
</code></pre><h3 id="3、处理新增-pod（handlepodaddtions）"><a name="3、处理新增-pod（handlepodaddtions）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#3%E3%80%81%E5%A4%84%E7%90%86%E6%96%B0%E5%A2%9E-pod%EF%BC%88handlepodaddtions%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>3、处理新增 pod（HandlePodAddtions）</h3>
<p>对于事件中的每个 pod，执行以下操作：</p>
<ul>
<li>1、把所有的 pod 按照创建日期进行排序，保证最先创建的 pod 会最先被处理</li>
<li>2、把它加入到 podManager 中，podManager 子模块负责管理这台机器上的 pod 的信息，pod 和 mirrorPod 之间的对应关系等等。所有被管理的 pod 都要出现在里面，如果 podManager 中找不到某个 pod，就认为这个 pod 被删除了</li>
<li>3、如果是 mirror pod 调用其单独的方法</li>
<li>4、验证 pod 是否能在该节点运行，如果不可以直接拒绝</li>
<li>5、通过 dispatchWork 把创建 pod 的工作下发给 podWorkers 子模块做异步处理</li>
<li>6、在 probeManager 中添加 pod，如果 pod 中定义了 readiness 和 liveness 健康检查，启动 goroutine 定期进行检测</li>
</ul>
<pre class="language-"><code>func (kl *Kubelet) HandlePodAdditions(pods []*v1.Pod) {
    start := kl.clock.Now()
    // 对所有 pod 按照日期排序，保证最先创建的 pod 优先被处理
    sort.Sort(sliceutils.PodsByCreationTime(pods))
    for _, pod := range pods {
        if kl.dnsConfigurer != nil &amp;&amp; kl.dnsConfigurer.ResolverConfig != "" {
            kl.dnsConfigurer.CheckLimitsForResolvConf()
        }
        existingPods := kl.podManager.GetPods()
        // 把 pod 加入到 podManager 中
        kl.podManager.AddPod(pod)

        // 判断是否是 mirror pod（即 static pod）
        if kubepod.IsMirrorPod(pod) {
            kl.handleMirrorPod(pod, start)
            continue
        }

        if !kl.podIsTerminated(pod) {
            activePods := kl.filterOutTerminatedPods(existingPods)
            // 通过 canAdmitPod 方法校验Pod能否在该计算节点创建(如:磁盘空间)
            // Check if we can admit the pod; if not, reject it.
            if ok, reason, message := kl.canAdmitPod(activePods, pod); !ok {
                kl.rejectPod(pod, reason, message)
                continue
            }
        }

        mirrorPod, _ := kl.podManager.GetMirrorPodByPod(pod)
        // 通过 dispatchWork 分发 pod 做异步处理，dispatchWork 主要工作就是把接收到的参数封装成 UpdatePodOptions，调用 UpdatePod 方法.
        kl.dispatchWork(pod, kubetypes.SyncPodCreate, mirrorPod, start)
        // 在 probeManager 中添加 pod，如果 pod 中定义了 readiness 和 liveness 健康检查，启动 goroutine 定期进行检测
        kl.probeManager.AddPod(pod)
    }
}
</code></pre><blockquote>
<p>static pod 是由 kubelet 直接管理的，k8s apiserver 并不会感知到 static pod 的存在，当然也不会和任何一个 rs 关联上，完全是由 kubelet 进程来监管，并在它异常时负责重启。Kubelet 会通过 apiserver 为每一个 static pod 创建一个对应的 mirror pod，如此以来就可以可以通过 kubectl 命令查看对应的 pod,并且可以通过 kubectl logs 命令直接查看到static pod 的日志信息。</p>
</blockquote>
<h3 id="4、下发任务（dispatchwork）"><a name="4、下发任务（dispatchwork）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#4%E3%80%81%E4%B8%8B%E5%8F%91%E4%BB%BB%E5%8A%A1%EF%BC%88dispatchwork%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>4、下发任务（dispatchWork）</h3>
<p>dispatchWorker 的主要作用是把某个对 Pod 的操作（创建/更新/删除）下发给 podWorkers。</p>
<pre class="language-"><code>func (kl *Kubelet) dispatchWork(pod *v1.Pod, syncType kubetypes.SyncPodType, mirrorPod *v1.Pod, start time.Time) {
    if kl.podIsTerminated(pod) {
        if pod.DeletionTimestamp != nil {
            kl.statusManager.TerminatePod(pod)
        }
        return
    }
    // 落实在 podWorkers 中
    kl.podWorkers.UpdatePod(&amp;UpdatePodOptions{
        Pod:        pod,
        MirrorPod:  mirrorPod,
        UpdateType: syncType,
        OnCompleteFunc: func(err error) {
            if err != nil {
                metrics.PodWorkerLatency.WithLabelValues(syncType.String()).Observe(metrics.SinceInMicroseconds(start))
            }
        },
    })
    if syncType == kubetypes.SyncPodCreate {
        metrics.ContainersPerPodCount.Observe(float64(len(pod.Spec.Containers)))
    }
}
</code></pre><h3 id="5、更新事件的-channel（updatepod）"><a name="5、更新事件的-channel（updatepod）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#5%E3%80%81%E6%9B%B4%E6%96%B0%E4%BA%8B%E4%BB%B6%E7%9A%84-channel%EF%BC%88updatepod%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>5、更新事件的 channel（UpdatePod）</h3>
<p>podWorkers 子模块主要的作用就是处理针对每一个的 Pod 的更新事件，比如 Pod 的创建，删除，更新。而 podWorkers 采取的基本思路是：为每一个 Pod 都单独创建一个 goroutine 和更新事件的 channel，goroutine 会阻塞式的等待 channel 中的事件，并且对获取的事件进行处理。而 podWorkers 对象自身则主要负责对更新事件进行下发。</p>
<pre class="language-"><code>func (p *podWorkers) UpdatePod(options *UpdatePodOptions) {
    pod := options.Pod
    uid := pod.UID
    var podUpdates chan UpdatePodOptions
    var exists bool

    p.podLock.Lock()
    defer p.podLock.Unlock()

    // 如果当前 pod 还没有启动过 goroutine ，则启动 goroutine，并且创建 channel
    if podUpdates, exists = p.podUpdates[uid]; !exists {
        // 创建 channel
        podUpdates = make(chan UpdatePodOptions, 1)
        p.podUpdates[uid] = podUpdates

        // 启动 goroutine
        go func() {
            defer runtime.HandleCrash()
            p.managePodLoop(podUpdates)
        }()
    }
    // 下发更新事件
    if !p.isWorking[pod.UID] {
        p.isWorking[pod.UID] = true
        podUpdates &lt;- *options
    } else {
        update, found := p.lastUndeliveredWorkUpdate[pod.UID]
        if !found || update.UpdateType != kubetypes.SyncPodKill {
            p.lastUndeliveredWorkUpdate[pod.UID] = *options
        }
    }
}
</code></pre><h3 id="6、调用-syncpodfn-方法同步-pod（managepodloop）"><a name="6、调用-syncpodfn-方法同步-pod（managepodloop）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#6%E3%80%81%E8%B0%83%E7%94%A8-syncpodfn-%E6%96%B9%E6%B3%95%E5%90%8C%E6%AD%A5-pod%EF%BC%88managepodloop%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>6、调用 syncPodFn 方法同步 pod（managePodLoop）</h3>
<p>managePodLoop 调用 syncPodFn 方法去同步 pod，syncPodFn 实际上就是kubelet.SyncPod。在完成这次 sync 动作之后，会调用 wrapUp 函数，这个函数将会做几件事情:</p>
<ul>
<li>将这个 pod 信息插入 kubelet 的 workQueue 队列中，等待下一次周期性的对这个 pod 的状态进行 sync</li>
<li>将在这次 sync 期间堆积的没有能够来得及处理的最近一次 update 操作加入 goroutine 的事件 channel 中，立即处理。</li>
</ul>
<pre class="language-"><code>func (p *podWorkers) managePodLoop(podUpdates &lt;-chan UpdatePodOptions) {
    var lastSyncTime time.Time
    for update := range podUpdates {
        err := func() error {
            podUID := update.Pod.UID
            status, err := p.podCache.GetNewerThan(podUID, lastSyncTime)
            if err != nil {
                ...
            }
            err = p.syncPodFn(syncPodOptions{
                mirrorPod:      update.MirrorPod,
                pod:            update.Pod,
                podStatus:      status,
                killPodOptions: update.KillPodOptions,
                updateType:     update.UpdateType,
            })
            lastSyncTime = time.Now()
            return err
        }()
        if update.OnCompleteFunc != nil {
            update.OnCompleteFunc(err)
        }
        if err != nil {
            ...
        }
        p.wrapUp(update.Pod.UID, err)
    }
}
</code></pre><h3 id="7、完成创建容器前的准备工作（syncpod）"><a name="7、完成创建容器前的准备工作（syncpod）" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#7%E3%80%81%E5%AE%8C%E6%88%90%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%EF%BC%88syncpod%EF%BC%89"><i class="fa fa-link" aria-hidden="true"></i></a>7、完成创建容器前的准备工作（SyncPod）</h3>
<p>在这个方法中，主要完成以下几件事情：</p>
<ul>
<li>如果是删除 pod，立即执行并返回</li>
<li>同步 podStatus 到 kubelet.statusManager</li>
<li>检查 pod 是否能运行在本节点，主要是权限检查（是否能使用主机网络模式，是否可以以 privileged 权限运行等）。如果没有权限，就删除本地旧的 pod 并返回错误信息</li>
<li>创建 containerManagar 对象，并且创建 pod level cgroup，更新 Qos level cgroup</li>
<li>如果是 static Pod，就创建或者更新对应的 mirrorPod</li>
<li>创建 pod 的数据目录，存放 volume 和 plugin 信息,如果定义了 pv，等待所有的 volume mount 完成（volumeManager 会在后台做这些事情）,如果有 image secrets，去 apiserver 获取对应的 secrets 数据</li>
<li>然后调用 kubelet.volumeManager 组件，等待它将 pod 所需要的所有外挂的 volume 都准备好。</li>
<li>调用 container runtime 的 SyncPod 方法，去实现真正的容器创建逻辑</li>
</ul>
<p>这里所有的事情都和具体的容器没有关系，可以看到该方法是创建 pod 实体（即容器）之前需要完成的准备工作。</p>
<pre class="language-"><code>func (kl *Kubelet) syncPod(o syncPodOptions) error {
    // pull out the required options
    pod := o.pod
    mirrorPod := o.mirrorPod
    podStatus := o.podStatus
    updateType := o.updateType

    // 是否为 删除 pod
    if updateType == kubetypes.SyncPodKill {
        ...
    }
    ...
    // 检查 pod 是否能运行在本节点
    runnable := kl.canRunPod(pod)
    if !runnable.Admit {
        ...
    }

    // 更新 pod 状态
    kl.statusManager.SetPodStatus(pod, apiPodStatus)

    // 如果 pod 非 running 状态则直接 kill 掉
    if !runnable.Admit || pod.DeletionTimestamp != nil || apiPodStatus.Phase == v1.PodFailed {
        ...
    }

    // 加载网络插件
    if rs := kl.runtimeState.networkErrors(); len(rs) != 0 &amp;&amp; !kubecontainer.IsHostNetworkPod(pod) {
        ...
    }

    pcm := kl.containerManager.NewPodContainerManager()
    if !kl.podIsTerminated(pod) {
        ...
        // 创建并更新 pod 的 cgroups
        if !(podKilled &amp;&amp; pod.Spec.RestartPolicy == v1.RestartPolicyNever) {
            if !pcm.Exists(pod) {
                ...
            }
        }
    }

    // 为 static pod 创建对应的 mirror pod
    if kubepod.IsStaticPod(pod) {
        ...
    }

    // 创建数据目录
    if err := kl.makePodDataDirs(pod); err != nil {
        ...
    }

    // 挂载 volume
    if !kl.podIsTerminated(pod) {
        if err := kl.volumeManager.WaitForAttachAndMount(pod); err != nil {
            ...
        }
    }

    // 获取 secret 信息
    pullSecrets := kl.getPullSecretsForPod(pod)

    // 调用 containerRuntime 的 SyncPod 方法开始创建容器
    result := kl.containerRuntime.SyncPod(pod, apiPodStatus, podStatus, pullSecrets, kl.backOff)
    kl.reasonCache.Update(pod.UID, result)
    if err := result.Error(); err != nil {
        ...
    }

    return nil
}
</code></pre><h3 id="8、创建容器"><a name="8、创建容器" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#8%E3%80%81%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><i class="fa fa-link" aria-hidden="true"></i></a>8、创建容器</h3>
<p>containerRuntime（pkg/kubelet/kuberuntime）子模块的 SyncPod 函数才是真正完成 pod 内容器实体的创建。
syncPod 主要执行以下几个操作：</p>
<ul>
<li>1、计算 sandbox 和 container 是否发生变化</li>
<li>2、创建 sandbox 容器</li>
<li>3、启动 init 容器</li>
<li>4、启动业务容器</li>
</ul>
<p>initContainers 可以有多个，多个 container 严格按照顺序启动，只有当前一个 container 退出了以后，才开始启动下一个 container。</p>
<pre class="language-"><code>func (m *kubeGenericRuntimeManager) SyncPod(pod *v1.Pod, _ v1.PodStatus, podStatus *kubecontainer.PodStatus, pullSecrets []v1.Secret, backOff *flowcontrol.Backoff) (result kubecontainer.PodSyncResult) {
    // 1、计算 sandbox 和 container 是否发生变化
    podContainerChanges := m.computePodActions(pod, podStatus)
    if podContainerChanges.CreateSandbox {
        ref, err := ref.GetReference(legacyscheme.Scheme, pod)
        if err != nil {
            glog.Errorf("Couldn't make a ref to pod %q: '%v'", format.Pod(pod), err)
        }
        ...
    }

    // 2、kill 掉 sandbox 已经改变的 pod
    if podContainerChanges.KillPod {
        ...
    } else {
        // 3、kill 掉非 running 状态的 containers
        ...
        for containerID, containerInfo := range podContainerChanges.ContainersToKill {
            ...
            if err := m.killContainer(pod, containerID, containerInfo.name, containerInfo.message, nil); err != nil {
                ...
            }
        }
    }

    m.pruneInitContainersBeforeStart(pod, podStatus)
    podIP := ""
    if podStatus != nil {
        podIP = podStatus.IP
    }

    // 4、创建 sandbox 
    podSandboxID := podContainerChanges.SandboxID
    if podContainerChanges.CreateSandbox {
        podSandboxID, msg, err = m.createPodSandbox(pod, podContainerChanges.Attempt)
        if err != nil {
            ...
        }
        ...
        podSandboxStatus, err := m.runtimeService.PodSandboxStatus(podSandboxID)
        if err != nil {
            ...
        }
        // 如果 pod 网络是 host 模式，容器也相同；其他情况下，容器会使用 None 网络模式，让 kubelet 的网络插件自己进行网络配置
        if !kubecontainer.IsHostNetworkPod(pod) {
            podIP = m.determinePodSandboxIP(pod.Namespace, pod.Name, podSandboxStatus)
            glog.V(4).Infof("Determined the ip %q for pod %q after sandbox changed", podIP, format.Pod(pod))
        }
    }

    configPodSandboxResult := kubecontainer.NewSyncResult(kubecontainer.ConfigPodSandbox, podSandboxID)
    result.AddSyncResult(configPodSandboxResult)
    // 获取 PodSandbox 的配置(如:metadata,clusterDNS,容器的端口映射等)
    podSandboxConfig, err := m.generatePodSandboxConfig(pod, podContainerChanges.Attempt)
    ...

    // 5、启动 init container
    if container := podContainerChanges.NextInitContainerToStart; container != nil {
        ...
        if msg, err := m.startContainer(podSandboxID, podSandboxConfig, container, pod, podStatus, pullSecrets, podIP, kubecontainer.ContainerTypeInit); err != nil {
            ...
        }
    }

    // 6、启动业务容器
    for _, idx := range podContainerChanges.ContainersToStart {
        ...
        if msg, err := m.startContainer(podSandboxID, podSandboxConfig, container, pod, podStatus, pullSecrets, podIP, kubecontainer.ContainerTypeRegular); err != nil {
            ...
        }
    }

    return
}
</code></pre><h3 id="9、启动容器"><a name="9、启动容器" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#9%E3%80%81%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><i class="fa fa-link" aria-hidden="true"></i></a>9、启动容器</h3>
<p>最终由 startContainer 完成容器的启动，其主要有以下几个步骤：</p>
<ul>
<li>1、拉取镜像</li>
<li>2、生成业务容器的配置信息</li>
<li>3、调用 docker api 创建容器</li>
<li>4、启动容器</li>
<li>5、执行 post start hook</li>
</ul>
<pre class="language-"><code>func (m *kubeGenericRuntimeManager) startContainer(podSandboxID string, podSandboxConfig *runtimeapi.PodSandboxConfig, container *v1.Container, pod *v1.Pod, podStatus *kubecontainer.PodStatus, pullSecrets []v1.Secret, podIP string, containerType kubecontainer.ContainerType) (string, error) {
    // 1、检查业务镜像是否存在，不存在则到 Docker Registry 或是 Private Registry 拉取镜像。
    imageRef, msg, err := m.imagePuller.EnsureImageExists(pod, container, pullSecrets)
    if err != nil {
        ...
    }

    ref, err := kubecontainer.GenerateContainerRef(pod, container)
    if err != nil {
        ...
    }

    // 设置 RestartCount 
    restartCount := 0
    containerStatus := podStatus.FindContainerStatusByName(container.Name)
    if containerStatus != nil {
        restartCount = containerStatus.RestartCount + 1
    }

    // 2、生成业务容器的配置信息
    containerConfig, cleanupAction, err := m.generateContainerConfig(container, pod, restartCount, podIP, imageRef, containerType)
    if cleanupAction != nil {
        defer cleanupAction()
    }
    ...

    // 3、通过 client.CreateContainer 调用 docker api 创建业务容器
    containerID, err := m.runtimeService.CreateContainer(podSandboxID, containerConfig, podSandboxConfig)
    if err != nil {
        ...
    }
    err = m.internalLifecycle.PreStartContainer(pod, container, containerID)
    if err != nil {
        ...
    }
    ...

    // 3、启动业务容器
    err = m.runtimeService.StartContainer(containerID)
    if err != nil {
        ...
    }

    containerMeta := containerConfig.GetMetadata()
    sandboxMeta := podSandboxConfig.GetMetadata()
    legacySymlink := legacyLogSymlink(containerID, containerMeta.Name, sandboxMeta.Name,
        sandboxMeta.Namespace)
    containerLog := filepath.Join(podSandboxConfig.LogDirectory, containerConfig.LogPath)
    if _, err := m.osInterface.Stat(containerLog); !os.IsNotExist(err) {
        if err := m.osInterface.Symlink(containerLog, legacySymlink); err != nil {
            glog.Errorf("Failed to create legacy symbolic link %q to container %q log %q: %v",
                legacySymlink, containerID, containerLog, err)
        }
    }

    // 4、执行 post start hook
    if container.Lifecycle != nil &amp;&amp; container.Lifecycle.PostStart != nil {
        kubeContainerID := kubecontainer.ContainerID{
            Type: m.runtimeName,
            ID:   containerID,
        }
        // runner.Run 这个方法的主要作用就是在业务容器起来的时候，
        // 首先会执行一个 container hook(PostStart 和 PreStop),做一些预处理工作。
        // 只有 container hook 执行成功才会运行具体的业务服务，否则容器异常。
        msg, handlerErr := m.runner.Run(kubeContainerID, pod, container, container.Lifecycle.PostStart)
        if handlerErr != nil {
            ...
        }
    }

    return "", nil
}
</code></pre><h2 id="总结"><a name="总结" class="anchor-navigation-ex-anchor" href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_create_pod.html#%E6%80%BB%E7%BB%93"><i class="fa fa-link" aria-hidden="true"></i></a>总结</h2>
<p>本文主要讲述了 kubelet 从监听到容器调度至本节点再到创建容器的一个过程，kubelet 最终调用 docker api 来创建容器的。结合上篇文章，可以看出 kubelet 从启动到创建 pod 的一个清晰过程。</p>
<p>参考：</p>
<p><a href="https://sycki.com/articles/kubernetes/k8s-code-kubelet" target="_blank">k8s源码分析-kubelet</a></p>
<p><a href="https://segmentfault.com/a/1190000008267351" target="_blank">Kubelet源码分析(一):启动流程分析</a></p>
<p><a href="http://cizixs.com/2017/06/07/kubelet-source-code-analysis-part-2/" target="_blank">kubelet 源码分析：pod 新建流程</a></p>
<p><a href="https://fatsheep9146.github.io/2018/07/22/kubelet%E5%88%9B%E5%BB%BAPod%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/" target="_blank">kubelet创建Pod流程解析</a></p>
<p><a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/node/pod-lifecycle-event-generator.md" target="_blank">Kubelet: Pod Lifecycle Event Generator (PLEG) Design-    proposals</a></p>
<footer class="page-footer"><span class="copyright">Copyright © tianfeiyu 2019 all right reserved，powered by Gitbook</span><span class="footer-modification">该文件修订时间：
2019-12-29 15:13:21
</span></footer> <link rel="stylesheet" type="text/css" href="./kubelet 创建 pod 的流程 · 田飞雨_files/codemirror.css"> <script>     window.klipse_settings = {         selector: ".language-klipse, .lang-eval-clojure",         selector_eval_js: ".lang-eval-js",         selector_eval_python_client: ".lang-eval-python",         selector_eval_php: ".lang-eval-php",         selector_eval_scheme: ".lang-eval-scheme",         selector_eval_ruby: ".lang-eval-ruby",         selector_reagent: ".lang-reagent",        selector_google_charts: ".lang-google-chart",        selector_es2017: ".lang-eval-es2017",        selector_jsx: ".lang-eval-jsx",        selector_transpile_jsx: ".lang-transpile-jsx",        selector_render_jsx: ".lang-render-jsx",        selector_react: ".lang-react",        selector_eval_markdown: ".lang-render-markdown",        selector_eval_lambdaway: ".lang-render-lambdaway",        selector_eval_cpp: ".lang-eval-cpp",        selector_eval_html: ".lang-render-html",        selector_sql: ".lang-eval-sql",        selector_brainfuck: "lang-eval-brainfuck",        selector_js: ".lang-transpile-cljs"    }; </script> <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/klipse_plugin.js.下载"></script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/kubelet_init.html" class="navigation navigation-prev " aria-label="Previous page: kubelet 启动流程分析">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="https://blog.tianfeiyu.com/source-code-reading-notes/kubernetes/node_status.html" class="navigation navigation-next " aria-label="Next page: kubelet 状态上报的方式" style="margin-right: 17px;">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"kubelet 创建 pod 的流程","date":"2019-01-03T08:15:30.000Z","tags":"kubelet","type":"kubelet","level":"1.2.19","depth":2,"next":{"title":"kubelet 状态上报的方式","level":"1.2.20","depth":2,"path":"kubernetes/node_status.md","ref":"kubernetes/node_status.md","articles":[]},"previous":{"title":"kubelet 启动流程分析","level":"1.2.18","depth":2,"path":"kubernetes/kubelet_init.md","ref":"kubernetes/kubelet_init.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-comscore","-lunr","-search","-highlight","-livereload","search-plus@^0.0.11","simple-page-toc@^0.1.1","github@^2.0.0","github-buttons@2.1.0","edit-link@^2.0.2","prism@^2.1.0","prism-themes@^0.0.2","advanced-emoji@^0.2.1","anchors@^0.7.1","include-codeblock@^3.0.2","ace@^0.3.2","emphasize@^1.1.0","katex@^1.1.3","splitter@^0.0.8","mermaid-gb3@2.1.0","tbfed-pagefooter@^0.0.1","expandable-chapters-small@^0.1.7","sectionx@^3.1.0","local-video@^1.0.1","sitemap-general@^0.1.1","anchor-navigation-ex@0.1.8","favicon@^0.0.2","todo@^0.1.3","3-ba@^0.9.0","terminal@^0.3.2","alerts@^0.2.0","include-csv@^0.1.0","puml@^1.0.1","musicxml@^1.0.2","klipse@^1.2.0","versions-select@^0.1.1","-sharing","sharing-plus@^0.0.2","graph@^0.1.0","chart@^0.2.0"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © tianfeiyu 2019","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-base16-ateliersulphurpool.light.css"]},"include-csv":{},"disqus":{"shortName":"gitbookuse"},"emphasize":{},"ace":{},"github":{"url":"https://github.com/gosoon/source-code-reading-notes"},"puml":{},"simple-page-toc":{"maxDepth":3,"skipFirstH1":true},"todo":{},"splitter":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"versions-select":{"type":"branches"},"graph":{},"sitemap-general":{"prefix":"https://blog.tianfeiyu.com"},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"rss":{"title":"田飞雨","description":"源码分析相关的文章，主要是专注云原生实践","author":"gosoon","site_url":"https://blog.tianfeiyu.com","managingEditor":"","webMaster":"","categories":["gitbook"]},"musicxml":{},"sectionx":{"tag":"b"},"mermaid-gb3":{},"anchor-navigation-ex":{"isRewritePageTitle":false,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right"},"favicon":{"shortcut":"favicon.ico","bookmark":"favicon.ico"},"theme-comscore":{},"prism-themes":{},"alerts":{},"github-buttons":{"repo":"gosoon/source-code-reading-notes","types":["star"],"size":"large"},"3-ba":{"configuration":"auto","token":"ff100361cdce95dd4c8fb96b4009f7bc"},"expandable-chapters-small":{},"local-video":{},"klipse":{"myConfigKey":"it's the default value"},"advanced-emoji":{"embedEmojis":false},"include-codeblock":{"check":false,"edit":true,"fixlang":false,"lang":"","template":"ace","theme":"chrome","unindent":true},"sharing":{"qq":false,"all":["facebook","google","twitter","weibo","instapaper","linkedin","pocket","stumbleupon","qq","qzone"],"douban":false,"facebook":false,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":true,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":true},"terminal":{"copyButtons":true,"fade":false,"style":"flat"},"edit-link":{"label":"Edit This Page","base":"https://github.com/gosoon/source-code-reading-notes/edit/master"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchors":{},"chart":{"type":"c3"},"search-plus":{}},"theme":"default","author":"gosoon","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"田飞雨","language":"zh-hans","output.name":"site","links":{"sidebar":{"Home":"https://blog.tianfeiyu.com"}},"gitbook":"3.2.3","description":"源码分析相关的文章，主要是专注 k8s 云原生实践"},"file":{"path":"kubernetes/kubelet_create_pod.md","mtime":"2019-12-29T07:13:21.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-03-17T08:42:21.622Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/gitbook.js.下载"></script>
    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/theme.js.下载"></script>
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/jquery.mark.min.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/search.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(1).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(2).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/ace.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/ace.js(1).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/splitter.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(3).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/expandable-chapters-small.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/bootstrap.min.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/sectionx.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/video.min.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(4).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(5).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(6).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/osmd.min.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/musicxml.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/promise.min.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/plugin.js(7).下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/buttons.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/fontsettings.js.下载"></script>
        
    
        
        <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/test.js.下载"></script>
        
    

    <script src="./kubelet 创建 pod 的流程 · 田飞雨_files/mermaid.min.js.下载"></script>

    


<textarea id="t-textarea"></textarea></body></html>